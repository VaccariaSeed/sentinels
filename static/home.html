<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sentinels哨兵采集控制器</title>
    <link rel="stylesheet" href="css/all.min.css">
    <link rel="stylesheet" href="css/sys.css">
    <script src="js/sys.js"></script>
</head>
<body>
<div class="container">
    <header>
        <h1>sentinels哨兵采集控制器</h1>
        <p>集中管理设备配置、点位信息的综合组件，提供高效可靠的物联网设备监控与控制</p>
    </header>

    <div class="tabs">
        <div class="tab active" data-tab="device-config">设备配置</div>
        <div class="tab" data-tab="point-config">点位配置</div>
        <div class="tab" data-tab="user-operations">用户操作</div>
        <div class="tab" data-tab="system-monitor">系统监控</div>
    </div>

    <!-- 系统监控标签页 -->
    <div class="tab-content" id="system-monitor">
        <div>
            <button id="refreshBtn" class="refresh-btn" style="margin-bottom: 1em;">
                <span class="text">刷新数据</span>
            </button>
            <p style="margin-bottom: 1em;">刷新数据重新获取当前页面展示量</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3>设备总数</h3>
                <div class="value" id="totalDevices">0</div>
            </div>
            <div class="stat-card">
                <h3>在线设备</h3>
                <div class="value" id="onlineDevices">0</div>
            </div>
            <div class="stat-card">
                <h3>告警设备</h3>
                <div class="value" id="alarmDevices">0</div>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>设备名</th>
                    <th>设备编码</th>
                    <th>采集点位总数</th>
                    <th>当前告警数量</th>
                    <th>状态</th>
                    <th>最后一次通讯时间</th>
                </tr>
                </thead>
                <tbody id="deviceTableBody">
                <tr>
                    <td colspan="7">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- 设备配置标签页 -->
    <div class="tab-content active" id="device-config">
        <h2>设备配置管理</h2>
        <p>管理所有连接的设备信息，包括设备ID、名称、编码、连接类型等参数</p>

        <div class="action-buttons">
            <button class="btn btn-primary" id="add-device-btn">
                <i class="fas fa-plus"></i> 新增设备
            </button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>操作状态</th>
                    <th>设备ID</th>
                    <th>设备名称</th>
                    <th>设备编码</th>
                    <th>存储表名</th>
                    <th>接口类型</th>
                    <th>地址</th>
                    <th>波特率</th>
                    <th>停止位</th>
                    <th>校验位</th>
                    <th>数据位</th>
                    <th>协议类型</th>
                    <th>设备地址</th>
                    <th>读超时</th>
                    <th>写超时</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <!-- 设备数据将通过JavaScript动态加载 -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- 点位配置标签页 -->
    <div class="tab-content" id="point-config">
        <h2>点位配置管理</h2>
        <p>配置设备的具体点位信息，包括功能码、地址、数据类型、TAG标志等参数</p>
        <label style="display:block;margin-top: 30px;"></label>
        <div class="form-group">
            <div class="form-item">
                <label for="device-select">选择设备类型</label>
                <select id="device-select">
                    <option value="">请选择</option>
                </select>
            </div>

            <div class="form-item">
                <label for="device-mark">设备描述</label>
                <input type="text" id="device-mark" name="device-mark" autocomplete="off" placeholder="输入设备描述">
            </div>

            <button class="search-btn" id="search-btn" name="search-btn">搜索</button>
        </div>

        <label style="display:block;margin-top: 30px;"></label>

        <div class="action-buttons">
            <button class="btn btn-primary" id="add-point-btn">
                <i class="fas fa-plus"></i> 新增点位
            </button>
            <button class="btn btn-primary" id="collection-rule-btn">
                <i class="fas fa-edit"></i> 编辑采集规则
            </button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>功能码</th>
                    <th>地址</th>
                    <th>数据类型</th>
                    <th>TAG标志</th>
                    <th>Lua表达式</th>
                    <th>描述</th>
                    <th>告警配置</th>
                    <th>告警等级</th>
                    <th>倍率</th>
                    <th>单位</th>
                    <th>优先级</th>
                    <th>大小端</th>
                    <th>bit位计算</th>
                    <th>起始bit位</th>
                    <th>结束bit位</th>
                    <th>存储方式</th>
                    <th>偏移量</th>
                    <th>入库间隔秒</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <!-- 点位数据将通过JavaScript动态加载 -->
                </tbody>
            </table>
        </div>

        <div class="pagination">
            <button class="active">1</button>
            <button>2</button>
            <button>3</button>
            <button>下一页</button>
        </div>
    </div>

    <!-- 用户操作标签页 -->
    <div class="tab-content" id="user-operations">
        <h2>用户操作</h2>
        <p>执行系统级操作，包括暂停数据采集、刷新页面、清空数据和导入配置等</p>

        <div class="user-actions">
            <div class="user-action-card">
                <i class="fas fa-pause-circle"></i>
                <h3>暂停</h3>
                <p>暂停数据采集和监控</p>
                <button class="btn btn-warning">执行暂停</button>
            </div>

            <div class="user-action-card">
                <i class="fas fa-sync-alt"></i>
                <h3>刷新</h3>
                <p>刷新采集控制配置</p>
                <button class="btn btn-primary">执行刷新</button>
            </div>

            <div class="user-action-card">
                <i class="fas fa-trash-alt"></i>
                <h3>清空</h3>
                <p>清空所有历史数据</p>
                <button class="btn btn-danger">执行清空</button>
            </div>

            <div class="user-action-card">
                <i class="fas fa-file-import"></i>
                <h3>导入</h3>
                <p>导入已经配置好的配置文件</p>
                <button class="btn btn-success">选择文件</button>
            </div>

            <div class="user-action-card">
                <i class="fas fa-download"></i>
                <h3>下载模板</h3>
                <p>下载导入模板文件</p>
                <button class="btn btn-primary">下载</button>
            </div>
        </div>
    </div>

    <footer>
        <p>sentinels哨兵采集控制器 &copy; 2025 - 版权所有人:VaccariaSeed</p>
    </footer>
</div>

<!-- 告警详情模态框 -->
<div class="modal" id="alarmModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>告警详情 - 设备 <span id="modalDeviceName"></span></h2>
            <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="loading" id="modalLoading">
                <div class="spinner"></div>
            </div>
            <div class="error-message" id="modalError" style="display: none;">
                加载告警详情失败
            </div>
            <div class="table-container">
                <table id="alarmTable" style="min-width:100%;display: none;">
                    <thead>
                    <tr>
                        <th>告警点位</th>
                        <th>点位描述</th>
                        <th>当前值</th>
                        <th>告警等级</th>
                        <th>告警判定条件</th>
                    </tr>
                    </thead>
                    <tbody id="alarmTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- 设备配置模态框 -->
<div class="modal" id="device-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>设备配置</h2>
            <span class="close">&times;</span>
        </div>
        <form id="device-form">
            <input type="hidden" id="device-id" name="device-id">

            <div class="form-row">
                <div class="form-col-3">
                    <label for="device-name">设备名称</label>
                    <input type="text" id="device-name" autocomplete="off" name="device-name" required>
                </div>
                <div class="form-col-3">
                    <label for="device-code">设备编码</label>
                    <input type="text" id="device-code" autocomplete="off" name="device-code" required>
                </div>
                <div class="form-col-3">
                    <label for="initial-status">初始状态</label>
                    <select id="initial-status" name="initial-status" required>
                        <option value="active">运行</option>
                        <option value="inactive">停止</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col-3">
                    <label for="storage-table">存储表名</label>
                    <input type="text" id="storage-table" autocomplete="off" name="storage-table">
                </div>

                <div class="form-col-3">
                    <label for="interface-type">接口类型</label>
                    <select id="interface-type" name="interface-type" required>
                        <option value="">-- 选择连接类型 --</option>
                        <option value="RS485">RS485</option>
                        <option value="RS232">RS232</option>
                        <option value="TCP_CLIENT">TCP客户端</option>
                        <option value="TCP_CLIENT_REUSE">TCP客户端（端口复用）</option>
                        <option value="TCP_SERVER">TCP服务端</option>
                        <option value="UDP_CLIENT">UDP客户端</option>
                        <option value="UDP_SERVER">UDP服务端</option>
                        <option value="CAN">CAN</option>
                        <option value="SPS">串口服务器</option>
                    </select>
                </div>
                <div class="form-col-3">
                    <label for="address">通讯地址（IP:PORT, 串口号等）</label>
                    <input type="text" id="address" autocomplete="off" name="address" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col-3">
                    <label for="baudRate">波特率</label>
                    <input type="text" id="baudRate" autocomplete="off" name="baudRate">
                </div>
                <div class="form-col-3">
                    <label for="stopBits">停止位</label>
                    <input type="text" id="stopBits" autocomplete="off" name="stopBits">
                </div>
                <div class="form-col-3">
                    <label for="parity">校验位</label>
                    <select id="parity" name="parity">
                        <option value="N" selected>无校验</option>
                        <option value="E">奇校验</option>
                        <option value="O">偶校验</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col-3">
                    <label for="dataBits">数据位</label>
                    <input type="text" id="dataBits" autocomplete="off" name="dataBits">
                </div>
                <div class="form-col-3">
                    <label for="protocol-type">协议类型</label>
                    <select id="protocol-type" name="protocol-type" required>
                        <option value="">-- 选择协议类型 --</option>
                        <option value="modbusRTU">modbusRTU</option>
                        <option value="modbusTCP">modbusTCP</option>
                        <option value="GB28181">GB28181</option>
                        <option value="698.45">698.45</option>
                        <option value="DLT645">DLT645</option>
                        <option value="1376.1">1376.1</option>
                        <option value="1867">1867</option>
                    </select>
                </div>
                <div class="form-col-3">
                    <label for="device-address">设备地址（如modbus的slaveId, 698的SN等）</label>
                    <input type="text" id="device-address" autocomplete="off" name="device-address" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col-3">
                    <label for="write-timeout">读超时，单位：秒</label>
                    <input type="text" id="write-timeout" autocomplete="off" name="write-timeout" value="3">
                </div>
                <div class="form-col-3">
                    <label for="read-timeout">写超时，单位：秒</label>
                    <input type="text" id="read-timeout" autocomplete="off" name="read-timeout" value="3">
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">保存</button>
                <button type="button" class="btn btn-danger" id="cancel-device">取消</button>
            </div>
        </form>
    </div>
</div>

<!-- 点位配置模态框 -->
<div class="modal" id="point-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>点位配置</h2>
            <span class="close">&times;</span>
        </div>
        <form id="point-form">
            <input type="hidden" id="point-id" name="point-id">

            <div class="form-row">
                <div class="form-col-3">
                    <label for="function-code">功能码</label>
                    <input type="text" id="function-code" autocomplete="off" name="function-code" required>
                </div>
                <div class="form-col-3">
                    <label for="point-address">地址</label>
                    <input type="text" name="point-address" autocomplete="off" id="point-address" required>
                </div>
                <div class="form-col-3">
                    <label for="data-type">数据类型</label>
                    <select id="data-type" name="data-type" required>
                        <option value="">-- 选择数据类型 --</option>
                        <option value="int8">int8</option>
                        <option value="int16">int16</option>
                        <option value="int32">int32</option>
                        <option value="int64">int64</option>
                        <option value="uint8">uint8</option>
                        <option value="uint16">uint16</option>
                        <option value="uint32">uint32</option>
                        <option value="uint64">uint64</option>
                        <option value="float32">float32</option>
                        <option value="float64">float64</option>
                        <option value="int8Arr">int8数组</option>
                        <option value="int16Arr">int16数组</option>
                        <option value="int32Arr">int32数组</option>
                        <option value="int64Arr">int64数组</option>
                        <option value="uint8Arr">uint8数组</option>
                        <option value="uint16Arr">uint16数组</option>
                        <option value="uint32Arr">uint32数组</option>
                        <option value="uint64Arr">uint64数组</option>
                        <option value="float32Arr">float32数组</option>
                        <option value="float64Arr">float64数组</option>
                        <option value="string">字符串</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col-3">
                    <label for="tag-flag">TAG标志</label>
                    <input type="text" id="tag-flag" autocomplete="off" name="tag-flag" required>
                </div>
                <div class="form-col-3">
                    <label for="lua-expression">Lua表达式</label>
                    <input type="text" id="lua-expression" autocomplete="off" name="lua-expression">
                </div>
                <div class="form-col-3">
                    <label for="description">描述</label>
                    <input type="text" id="description" autocomplete="off" name="description" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col-3">
                    <label for="alarm-flag">告警配置</label>
                    <input type="text" id="alarm-flag" autocomplete="off" name="alarm-flag" value="">
                </div>
                <div class="form-col-3">
                    <label for="alarm-level">告警等级</label>
                    <select id="alarm-level" name="alarm-level">
                        <option value="None" selected>不关注</option>
                        <option value="serious">严重</option>
                        <option value="high">高</option>
                        <option value="middle">中</option>
                        <option value="low">低</option>
                    </select>
                </div>
                <div class="form-col-3">
                    <label for="multiplier">倍率</label>
                    <input type="number" id="multiplier" autocomplete="off" name="multiplier" step="0.1" value="1.0">
                </div>
            </div>

            <div class="form-row">
                <div class="form-col-3">
                    <label for="unit">单位</label>
                    <input type="text" id="unit" name="unit" autocomplete="off">
                </div>
                <div class="form-col-3">
                    <label for="priority">优先级</label>
                    <select id="priority" name="priority">
                        <option value="3">高</option>
                        <option value="2">中</option>
                        <option value="1" selected>低</option>
                    </select>
                </div>
                <div class="form-col-3">
                    <label for="endianness">大小端</label>
                    <select id="endianness" name="endianness">
                        <option value="BIG">大端</option>
                        <option value="LITTLE">小端</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col-3">
                    <label for="bit-calculation">bit位计算</label>
                    <select id="bit-calculation" name="bit-calculation">
                        <option value="all">整算</option>
                        <option value="single">单bit位</option>
                        <option value="multiple">多bit位</option>
                    </select>
                </div>
                <div class="form-col-3">
                    <label for="start-bit">起始bit位</label>
                    <input type="number" id="start-bit" autocomplete="off" name="start-bit" value="">
                </div>
                <div class="form-col-3">
                    <label for="end-bit">结束bit位</label>
                    <input type="number" id="end-bit" autocomplete="off" name="end-bit" value="">
                </div>
            </div>

            <div class="form-row">
                <div class="form-col-3">
                    <label for="storage-method">存储方式</label>
                    <select id="storage-method" name="storage-method">
                        <option value="change" selected>变存</option>
                        <option value="direct">直存</option>
                    </select>
                </div>
                <div class="form-col-3">
                    <label for="offset">偏移量</label>
                    <input type="number" id="offset" autocomplete="off" name="offset" value="0">
                </div>
                <div class="form-col-3">
                    <label for="store">入库间隔:单位秒</label>
                    <input type="number" id="store" autocomplete="off" name="store" value="10">
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">保存</button>
                <button type="button" class="btn btn-danger" id="cancel-point">取消</button>
            </div>
        </form>
    </div>
</div>

<!-- 采集规则模态框 -->
<div class="modal" id="collection-rule-modal">
    <div class="modal-content large-modal">
        <div class="modal-header">
            <h2>编辑采集规则(只对modbus有效)</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <div class="action-buttons" style="margin-bottom: 15px;">
                <button class="btn btn-primary" id="add-rule-btn">
                    <i class="fas fa-plus"></i> 添加规则
                </button>
            </div>

            <div class="table-container" style="width: 100%">
                <table id="collection-rule-table" style="min-width:100%;">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>描述</th>
                        <th>modbus功能码</th>
                        <th>起始点位</th>
                        <th>结束点位</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody id="collection-rule-body" style="min-width:100%;">
                    <!-- 采集规则数据将通过JavaScript动态加载 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- 添加/编辑采集规则模态框 -->
<div class="modal" id="rule-edit-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="rule-edit-title">添加采集规则</h2>
            <span class="close">&times;</span>
        </div>
        <form id="rule-edit-form" style="width: 100%">
            <input type="hidden" id="rule-id" name="rule-id">

            <div class="form-row">
                <div class="form-col-2">
                    <label for="rule-description">描述</label>
                    <input type="text" id="rule-description" autocomplete="off" name="rule-description" required>
                </div>
                <div class="form-col-2">
                    <label for="rule-func-code">功能码</label>
                    <input type="text" id="rule-func-code" autocomplete="off" name="rule-description" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col-2">
                    <label for="start-point">起始点位</label>
                    <input type="text" id="start-point" autocomplete="off" name="start-point" required>
                </div>
                <div class="form-col-2">
                    <label for="end-point">结束点位</label>
                    <input type="text" id="end-point" autocomplete="off" name="end-point" required>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">保存</button>
                <button type="button" class="btn btn-danger" id="cancel-rule">取消</button>
            </div>
        </form>
    </div>
</div>
</body>
</html>